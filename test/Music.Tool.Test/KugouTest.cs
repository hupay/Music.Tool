using Microsoft.Extensions.DependencyInjection;
using Music.Tool.Model;
using Music.Tool.Platform;
using System.Text.Json;

namespace Music.Tool.Test
{
    public class KugouTest : BaseTest
    {
        private readonly Kugou _kugou;
        private object GetSongParam
        {
            get
            {
                return new
                {
                    r = "play/getdata",
                    hash = "3233818D07CAF22FE73B17B15BFCCF80",
                    album_id = "8311612",
                    dfid = "1aAcF31Utj2l0ZzFPO0Yjss0",
                    mid = "ccbb9592c3177be2f3977ff292e0f145",
                    platid = "4",
                    _ = DateTime.Now.Millisecond.ToString()
                };
            }
        }
        public KugouTest()
        {
            _kugou = _provider.GetService<Kugou>();
        }

        [Theory]
        [InlineData("阿刁")]
        public async Task SearchAsync(string keyword)
        {
            var result = await _kugou.SearchAsync(keyword);
            Assert.NotNull(result);
            Assert.True(result.Songs.Any());
            Assert.Equal("阿刁 (Live)", result.Songs.First().Name);
            Assert.NotNull(result.Songs.FirstOrDefault());
        }

        [Fact]
        public async Task GetSongAsync()
        {
            var result = await _kugou.GetSongAsync(GetSongParam);
            Assert.NotNull(result);
            Assert.Equal("阿刁 (Live)", result.Name);
        }

        [Fact]
        public void ParseText()
        {
            var text = """
                {"error_msg":"","data":{"correctiontip":"","pagesize":5,"page":1,"correctiontype":0,"total":480,"lists":[{"SQFileHash":"58A3D5C4D35A63C400E8A1CF4246F30F","PublishTime":"","Audioid":36722401,"SuperDuration":0,"OldCpy":0,"PublishAge":255,"HQBitrate":320,"PayType":3,"TagContent":"评论过万","Accompany":1,"SingerName":"张韶涵","FoldType":0,"HQPrivilege":10,"TopicRemark":"","OriOtherName":"Live","Source":"","SQFileSize":37012326,"AlbumAux":"","HQDuration":321,"Image":"http:\/\/imge.kugou.com\/stdmusic\/{size}\/20200812\/20200812171231851695.jpg","HQPayType":3,"M4aSize":0,"SQPkgPrice":1,"UploaderContent":"","FileSize":5143191,"IsOriginal":0,"FileHash":"3233818D07CAF22FE73B17B15BFCCF80","MvTrac":3,"Type":"audio","Bitrate":128,"SQPrice":200,"ExtName":"mp3","trans_param":{"qualitymap":{"attr0":49268},"cpy_grade":5,"classmap":{"attr0":234885128},"hash_offset":{"clip_hash":"D85B94900FA786689ADB032D65AB9EB1","start_byte":0,"end_ms":60000,"end_byte":960127,"file_type":0,"start_ms":0,"offset_hash":"18CF4D1179E8D0069BAA9684362FBD5E"},"pay_block_tpl":1,"cid":32027466,"display_rate":1,"cpy_attr0":15488,"hash_multitrack":"D2ACC4DBB1320BE836D4B27B6B6A956E","appid_block":"3124","musicpack_advance":1,"display":32,"cpy_level":1},"Grp":[{"SQFileHash":"","PublishTime":"","Audioid":121547514,"SuperDuration":0,"OldCpy":1,"PublishAge":255,"HQBitrate":320,"PayType":0,"TagContent":"","Accompany":1,"SingerName":"张韶涵","HQPrivilege":0,"TopicRemark":"","OriOtherName":"Live","Source":"","SQFileSize":0,"AlbumAux":"","HQDuration":349,"Image":"http:\/\/singerimg.kugou.com\/uploadpic\/softhead\/{size}\/20230511\/20230511191418434.jpg","HQPayType":0,"M4aSize":0,"SQPkgPrice":0,"UploaderContent":"","FileSize":5599903,"IsOriginal":0,"FileHash":"FF893CA4BFEF5062F09555DE8621DF31","MvTrac":3,"Type":"audio","Bitrate":128,"SQPrice":0,"ExtName":"mp3","trans_param":{"pay_block_tpl":1,"classmap":{"attr0":234881032},"cid":-1,"cpy_attr0":0,"hash_multitrack":"de90c74e5281ac8a63309182357cca92","qualitymap":{"attr0":49172},"musicpack_advance":0,"display":0,"display_rate":0},"Category":0,"SuperExtName":"","HQPkgPrice":0,"OtherName":"","SongName":"<en>阿刁<\/en> (Live)","ASQPrivilege":0,"AudioCdn":100,"SourceID":0,"SQDuration":0,"AlbumPrivilege":0,"HQFileSize":13999043,"AlbumID":"","AlbumName":"","SQPayType":0,"mvdata":[{"id":"3595502","trk":"3","hash":"DA52F6EC356F9FD61C05B0FA6DCF3CF4","typ":0}],"vvid":"","HQPrice":0,"Suffix":"(Live)","HQFailProcess":0,"MixSongID":"339400736","HasAlbum":0,"SuperBitrate":0,"HiFiQuality":1,"Singers":[{"name":"张韶涵","ip_id":0,"id":6811}],"SingerId":[6811],"ResDuration":0,"HQExtName":"mp3","ResBitrate":0,"MatchFlag":11,"Scid":121547514,"SuperFileHash":"","QualityLevel":2,"OriSongName":"<en>阿刁<\/en>","ResFileHash":"","SongLabel":"","SuperFileSize":0,"MvType":2,"mvTotal":0,"SQBitrate":0,"MvHash":"DA52F6EC356F9FD61C05B0FA6DCF3CF4","FailProcess":0,"SQExtName":"","HQFileHash":"1A9C5B35BCE44BBD622E9100782D51B2","TopicUrl":"","Auxiliary":"","Privilege":0,"Duration":349,"SQFailProcess":0,"OwnerCount":1235,"Uploader":"","ID":"339400736","TopID":0,"FileName":"张韶涵 - <en>阿刁<\/en> (Live)","PkgPrice":0,"A320Privilege":0,"RankId":0,"ResFileSize":0,"SQPrivilege":0,"recommend_type":0,"Price":0,"Publish":1}],"ASQPrivilege":10,"Category":1,"SuperExtName":"","HQPkgPrice":1,"OtherName":"","SongName":"<en>阿刁<\/en> (Live)","Res":{"PkgPrice":1,"Privilege":10,"PayType":3,"Price":200,"FailProcess":4},"AudioCdn":100,"SourceID":0,"SQDuration":321,"AlbumPrivilege":10,"HQFileSize":12857673,"AlbumID":"8311612","AlbumName":"歌手第二季 第二期","SQPayType":3,"mvdata":[{"id":"3595502","trk":"3","hash":"DA52F6EC356F9FD61C05B0FA6DCF3CF4","typ":0}],"vvid":"","HQPrice":200,"Suffix":"(Live)","HQFailProcess":4,"MixSongID":"105920545","HasAlbum":1,"SuperBitrate":0,"HiFiQuality":3,"Singers":[{"name":"张韶涵","ip_id":0,"id":6811}],"SingerId":[6811],"ResDuration":321,"HQExtName":"mp3","ResBitrate":1689,"MatchFlag":11,"Scid":36722401,"SuperFileHash":"","QualityLevel":3,"OriSongName":"<en>阿刁<\/en>","ResFileHash":"95B06E27601A0FB88885585D32F56D37","SongLabel":"","SuperFileSize":0,"MvType":2,"mvTotal":0,"SQBitrate":921,"MvHash":"DA52F6EC356F9FD61C05B0FA6DCF3CF4","FailProcess":4,"SQExtName":"flac","HQFileHash":"B553FA8858531B837288253021DF3BD7","TopicUrl":"","Auxiliary":"","Privilege":10,"Duration":321,"SQFailProcess":4,"OwnerCount":1121196,"Uploader":"","ID":"105920545","TopID":0,"FileName":"张韶涵 - <en>阿刁<\/en> (Live)","PkgPrice":1,"A320Privilege":10,"RankId":0,"ResFileSize":67886372,"SQPrivilege":10,"recommend_type":0,"Price":200,"Publish":1},{"SQFileHash":"AAB6642167D266B4C4DFD0E65C0E9B70","PublishTime":"","Audioid":24584197,"SuperDuration":0,"OldCpy":0,"PublishAge":255,"HQBitrate":320,"PayType":3,"TagContent":"评论过万","Accompany":1,"SingerName":"赵雷","FoldType":0,"HQPrivilege":10,"TopicRemark":"","OriOtherName":"","Source":"","SQFileSize":38289644,"AlbumAux":"","HQDuration":374,"Image":"http:\/\/imge.kugou.com\/stdmusic\/{size}\/20200620\/20200620111210903931.jpg","HQPayType":3,"M4aSize":0,"SQPkgPrice":1,"UploaderContent":"","FileSize":5987039,"IsOriginal":1,"FileHash":"9EDA87725F3C6524A0108FFAD6A950FB","MvTrac":3,"Type":"audio","Bitrate":128,"SQPrice":200,"ExtName":"mp3","trans_param":{"cpy_grade":5,"classmap":{"attr0":234885128},"qualitymap":{"attr0":49204},"pay_block_tpl":1,"cid":6195608,"display_rate":1,"cpy_attr0":0,"hash_multitrack":"23709dae0b595221b5a75f22d10c9642","appid_block":"3124","musicpack_advance":0,"display":32,"cpy_level":1},"Grp":[{"SQFileHash":"28DAD058E1608428C24F09282E92EF8F","PublishTime":"","Audioid":24584197,"SuperDuration":0,"OldCpy":0,"PublishAge":255,"HQBitrate":320,"PayType":3,"TagContent":"","Accompany":1,"SingerName":"赵雷","HQPrivilege":10,"TopicRemark":"","OriOtherName":"","Source":"","SQFileSize":38389756,"AlbumAux":"","HQDuration":375,"Image":"http:\/\/imge.kugou.com\/stdmusic\/{size}\/20191023\/20191023201308891906.jpg","HQPayType":3,"M4aSize":0,"SQPkgPrice":1,"UploaderContent":"","FileSize":6003765,"IsOriginal":0,"FileHash":"CA275A164A5338211F8C9E0895B09796","MvTrac":3,"Type":"audio","Bitrate":128,"SQPrice":200,"ExtName":"mp3","trans_param":{"cpy_grade":5,"classmap":{"attr0":234885128},"qualitymap":{"attr0":16436},"pay_block_tpl":1,"cid":76211549,"display_rate":1,"cpy_attr0":0,"hash_multitrack":"86B8DDF36804B22DF36952F47B83A142","hash_offset":{"clip_hash":"6FD5D5B639915555193BD2EECBEA7268","start_byte":0,"end_ms":60000,"end_byte":960123,"file_type":0,"start_ms":0,"offset_hash":"65380E458E2BEDD3D9E1ADFF7840588B"},"musicpack_advance":0,"display":32,"cpy_level":1},"Category":1,"SuperExtName":"","HQPkgPrice":1,"OtherName":"","SongName":"<en>阿刁<\/en>","ASQPrivilege":10,"AudioCdn":100,"SourceID":0,"SQDuration":375,"AlbumPrivilege":8,"HQFileSize":15006868,"AlbumID":"29076215","AlbumName":"乖,摸摸头2.0","SQPayType":3,"mvdata":[{"id":"642202","trk":"3","hash":"B5EECF25BECFE52E1856463414A41D12","typ":0}],"vvid":"","HQPrice":200,"Suffix":"","HQFailProcess":4,"MixSongID":"209850811","HasAlbum":1,"SuperBitrate":0,"HiFiQuality":2,"Singers":[{"name":"赵雷","ip_id":0,"id":3801}],"SingerId":[3801],"ResDuration":0,"HQExtName":"mp3","ResBitrate":0,"MatchFlag":11,"Scid":24584197,"SuperFileHash":"","QualityLevel":3,"OriSongName":"<en>阿刁<\/en>","ResFileHash":"","SongLabel":"","SuperFileSize":0,"MvType":2,"mvTotal":0,"SQBitrate":818,"MvHash":"B5EECF25BECFE52E1856463414A41D12","FailProcess":4,"SQExtName":"flac","HQFileHash":"B8BD9784C3A3A45781D56B0E9074D842","TopicUrl":"","Auxiliary":"","Privilege":8,"Duration":375,"SQFailProcess":4,"OwnerCount":1151,"Uploader":"","ID":"209850811","TopID":0,"FileName":"赵雷 - <en>阿刁<\/en>","PkgPrice":1,"A320Privilege":10,"RankId":0,"ResFileSize":0,"SQPrivilege":10,"recommend_type":0,"Price":200,"Publish":1},{"SQFileHash":"50BCC79F93F80B26B1524B2114705C19","PublishTime":"","Audioid":24584197,"SuperDuration":0,"OldCpy":1,"PublishAge":255,"HQBitrate":320,"PayType":0,"TagContent":"","Accompany":1,"SingerName":"赵雷","HQPrivilege":0,"TopicRemark":"","OriOtherName":"","Source":"","SQFileSize":38458180,"AlbumAux":"","HQDuration":374,"Image":"http:\/\/imge.kugou.com\/stdmusic\/{size}\/20181220\/20181220144110919618.jpg","HQPayType":0,"M4aSize":0,"SQPkgPrice":0,"UploaderContent":"","FileSize":5987035,"IsOriginal":0,"FileHash":"6AEE554907D94E12F4B8B18F7147C12D","MvTrac":3,"Type":"audio","Bitrate":128,"SQPrice":0,"ExtName":"mp3","trans_param":{"pay_block_tpl":1,"classmap":{"attr0":234885128},"cid":-1,"cpy_attr0":0,"hash_multitrack":"1d6825e8ad1a0b857f9bb8a746d02824","qualitymap":{"attr0":16436},"musicpack_advance":0,"display":32,"display_rate":1},"Category":1,"SuperExtName":"","HQPkgPrice":0,"OtherName":"","SongName":"<en>阿刁<\/en>","ASQPrivilege":0,"AudioCdn":100,"SourceID":0,"SQDuration":374,"AlbumPrivilege":0,"HQFileSize":15458844,"AlbumID":"20599565","AlbumName":"你坏","SQPayType":0,"mvdata":[{"id":"642202","trk":"3","hash":"B5EECF25BECFE52E1856463414A41D12","typ":0}],"vvid":"","HQPrice":0,"Suffix":"","HQFailProcess":0,"MixSongID":"153174799","HasAlbum":1,"SuperBitrate":0,"HiFiQuality":2,"Singers":[{"name":"赵雷","ip_id":0,"id":3801}],"SingerId":[3801],"ResDuration":0,"HQExtName":"mp3","ResBitrate":0,"MatchFlag":11,"Scid":24584197,"SuperFileHash":"","QualityLevel":3,"OriSongName":"<en>阿刁<\/en>","ResFileHash":"","SongLabel":"","SuperFileSize":0,"MvType":2,"mvTotal":0,"SQBitrate":822,"MvHash":"B5EECF25BECFE52E1856463414A41D12","FailProcess":0,"SQExtName":"flac","HQFileHash":"9E55291A8D25E4A318CFD8E40F401A19","TopicUrl":"","Auxiliary":"","Privilege":0,"Duration":374,"SQFailProcess":0,"OwnerCount":1074,"Uploader":"","ID":"153174799","TopID":0,"FileName":"赵雷 - <en>阿刁<\/en>","PkgPrice":0,"A320Privilege":0,"RankId":0,"ResFileSize":0,"SQPrivilege":0,"recommend_type":0,"Price":0,"Publish":1}],"Category":1,"SuperExtName":"","HQPkgPrice":1,"OtherName":"","SongName":"<en>阿刁<\/en>","ASQPrivilege":10,"AudioCdn":100,"SourceID":0,"SQDuration":374,"AlbumPrivilege":8,"HQFileSize":14967310,"AlbumID":"1946722","AlbumName":"无法长大","SQPayType":3,"mvdata":[{"typ":0,"trk":"3","hash":"B5EECF25BECFE52E1856463414A41D12","id":"642202"}],"vvid":"","HQPrice":200,"Suffix":"","HQFailProcess":4,"MixSongID":"53532118","HasAlbum":1,"SuperBitrate":0,"HiFiQuality":2,"Singers":[{"name":"赵雷","ip_id":0,"id":3801}],"SingerId":[3801],"ResDuration":0,"HQExtName":"mp3","ResBitrate":0,"MatchFlag":11,"Scid":24584197,"SuperFileHash":"","QualityLevel":3,"OriSongName":"<en>阿刁<\/en>","ResFileHash":"","SongLabel":"","SuperFileSize":0,"MvType":2,"mvTotal":0,"SQBitrate":818,"MvHash":"B5EECF25BECFE52E1856463414A41D12","FailProcess":4,"SQExtName":"flac","HQFileHash":"FFEC605BCDF271D8F9C52D143FABB154","TopicUrl":"","Auxiliary":"","Privilege":8,"Duration":374,"SQFailProcess":4,"OwnerCount":191219,"Uploader":"","ID":"53532118","TopID":0,"FileName":"赵雷 - <en>阿刁<\/en>","PkgPrice":1,"A320Privilege":10,"RankId":0,"ResFileSize":0,"SQPrivilege":10,"recommend_type":0,"Price":200,"Publish":1},{"SQFileHash":"","PublishTime":"","Audioid":40138908,"SuperDuration":0,"OldCpy":1,"PublishAge":255,"HQBitrate":320,"PayType":0,"TagContent":"","Accompany":1,"SingerName":"张韶涵","FoldType":0,"HQPrivilege":0,"TopicRemark":"","OriOtherName":"3D Live版","Source":"","SQFileSize":0,"AlbumAux":"","HQDuration":314,"Image":"http:\/\/singerimg.kugou.com\/uploadpic\/softhead\/{size}\/20230511\/20230511191418434.jpg","HQPayType":0,"M4aSize":0,"SQPkgPrice":0,"UploaderContent":"","FileSize":5029917,"IsOriginal":0,"FileHash":"2730A2BFE57F2E02C58D307B8E932121","MvTrac":3,"Type":"audio","Bitrate":128,"SQPrice":0,"ExtName":"mp3","trans_param":{"pay_block_tpl":1,"classmap":{"attr0":234885128},"cid":-1,"cpy_attr0":0,"hash_multitrack":"e1f12668dcceaf3b106e5cb84b74d208","qualitymap":{"attr0":49172},"musicpack_advance":0,"display":32,"display_rate":1},"Grp":[],"Category":0,"SuperExtName":"","HQPkgPrice":0,"OtherName":"","SongName":"<en>阿刁<\/en> (3D Live版)","ASQPrivilege":0,"AudioCdn":100,"SourceID":0,"SQDuration":0,"AlbumPrivilege":0,"HQFileSize":12575530,"AlbumID":"","AlbumName":"","SQPayType":0,"mvdata":[{"typ":0,"trk":"3","hash":"DD3970D0B63ED5B5C41275A25990A036","id":"1815622"}],"vvid":"","HQPrice":0,"Suffix":"(3D Live版)","HQFailProcess":0,"MixSongID":"110959384","HasAlbum":0,"SuperBitrate":0,"HiFiQuality":1,"Singers":[{"name":"张韶涵","ip_id":0,"id":6811}],"SingerId":[6811],"ResDuration":0,"HQExtName":"mp3","ResBitrate":0,"MatchFlag":11,"Scid":40138908,"SuperFileHash":"","QualityLevel":2,"OriSongName":"<en>阿刁<\/en>","ResFileHash":"","SongLabel":"","SuperFileSize":0,"MvType":2,"mvTotal":0,"SQBitrate":0,"MvHash":"DD3970D0B63ED5B5C41275A25990A036","FailProcess":0,"SQExtName":"","HQFileHash":"1418DC47002EA28E54FFACEDD2FB3859","TopicUrl":"","Auxiliary":"","Privilege":0,"Duration":314,"SQFailProcess":0,"OwnerCount":45258,"Uploader":"","ID":"110959384","TopID":0,"FileName":"张韶涵 - <en>阿刁<\/en> (3D Live版)","PkgPrice":0,"A320Privilege":0,"RankId":0,"ResFileSize":0,"SQPrivilege":0,"recommend_type":0,"Price":0,"Publish":1},{"SQFileHash":"","PublishTime":"","Audioid":104782979,"SuperDuration":0,"OldCpy":1,"PublishAge":255,"HQBitrate":320,"PayType":0,"TagContent":"","Accompany":1,"SingerName":"张韶涵","FoldType":0,"HQPrivilege":0,"TopicRemark":"","OriOtherName":"2018歌手第二季第2期现场) (3D环绕版","Source":"","SQFileSize":0,"AlbumAux":"","HQDuration":321,"Image":"http:\/\/singerimg.kugou.com\/uploadpic\/softhead\/{size}\/20230511\/20230511191418434.jpg","HQPayType":0,"M4aSize":0,"SQPkgPrice":0,"UploaderContent":"","FileSize":5145204,"IsOriginal":0,"FileHash":"C9081A621E28EFFCB9E6AEB42FD13DCD","MvTrac":3,"Type":"audio","Bitrate":128,"SQPrice":0,"ExtName":"mp3","trans_param":{"pay_block_tpl":1,"classmap":{"attr0":234885128},"cid":-1,"cpy_attr0":0,"hash_multitrack":"757F8E24EBFF15B31B9129CEDA606587","qualitymap":{"attr0":49172},"musicpack_advance":0,"display":32,"display_rate":1},"Grp":[],"Category":0,"SuperExtName":"","HQPkgPrice":0,"OtherName":"","SongName":"<en>阿刁<\/en> (2018歌手第二季第2期现场) (3D环绕版)","ASQPrivilege":0,"AudioCdn":100,"SourceID":0,"SQDuration":0,"AlbumPrivilege":0,"HQFileSize":13333819,"AlbumID":"","AlbumName":"","SQPayType":0,"mvdata":[{"id":"3595502","trk":"3","hash":"DA52F6EC356F9FD61C05B0FA6DCF3CF4","typ":0}],"vvid":"","HQPrice":0,"Suffix":"(2018歌手第二季第2期现场) (3D环绕版)","HQFailProcess":0,"MixSongID":"308710382","HasAlbum":0,"SuperBitrate":0,"HiFiQuality":1,"Singers":[{"name":"张韶涵","ip_id":0,"id":6811}],"SingerId":[6811],"ResDuration":0,"HQExtName":"mp3","ResBitrate":0,"MatchFlag":11,"Scid":104782979,"SuperFileHash":"","QualityLevel":2,"OriSongName":"<en>阿刁<\/en>","ResFileHash":"","SongLabel":"","SuperFileSize":0,"MvType":2,"mvTotal":0,"SQBitrate":0,"MvHash":"DA52F6EC356F9FD61C05B0FA6DCF3CF4","FailProcess":0,"SQExtName":"","HQFileHash":"B62DAD62638622AC5B117BDB3567E9C7","TopicUrl":"","Auxiliary":"","Privilege":0,"Duration":321,"SQFailProcess":0,"OwnerCount":7627,"Uploader":"","ID":"308710382","TopID":0,"FileName":"张韶涵 - <en>阿刁<\/en> (2018歌手第二季第2期现场) (3D环绕版)","PkgPrice":0,"A320Privilege":0,"RankId":0,"ResFileSize":0,"SQPrivilege":0,"recommend_type":0,"Price":0,"Publish":1},{"SQFileHash":"E6AD37C99B94FA2A55F3A9F5B5F7CB6F","PublishTime":"","Audioid":40678475,"SuperDuration":0,"OldCpy":1,"PublishAge":255,"HQBitrate":320,"PayType":0,"TagContent":"","Accompany":1,"SingerName":"夏侯钰涵","FoldType":0,"HQPrivilege":0,"TopicRemark":"","OriOtherName":"","Source":"","SQFileSize":26135009,"AlbumAux":"","HQDuration":268,"Image":"http:\/\/imge.kugou.com\/stdmusic\/{size}\/20190415\/20190415230949448062.jpg","HQPayType":0,"M4aSize":0,"SQPkgPrice":0,"UploaderContent":"","FileSize":4298100,"IsOriginal":0,"FileHash":"9547F5DCB11E49D58FC3A48FCB2C070C","MvTrac":0,"Type":"audio","Bitrate":128,"SQPrice":0,"ExtName":"mp3","trans_param":{"pay_block_tpl":1,"classmap":{"attr0":234881032},"cid":-1,"cpy_attr0":0,"hash_multitrack":"4190FDB8204278F16BCC1D184837C733","qualitymap":{"attr0":16436},"musicpack_advance":0,"display":0,"display_rate":0},"Grp":[{"SQFileHash":"","PublishTime":"","Audioid":37478949,"SuperDuration":0,"OldCpy":1,"PublishAge":255,"HQBitrate":0,"PayType":0,"TagContent":"","Accompany":1,"SingerName":"夏侯钰涵","HQPrivilege":0,"TopicRemark":"","OriOtherName":"","Source":"","SQFileSize":0,"AlbumAux":"","HQDuration":0,"Image":"http:\/\/singerimg.kugou.com\/uploadpic\/softhead\/{size}\/20230420\/20230420185725603432.jpg","HQPayType":0,"M4aSize":0,"SQPkgPrice":0,"UploaderContent":"","FileSize":4009729,"IsOriginal":0,"FileHash":"F8119748510B74145842332DC6DA0158","MvTrac":0,"Type":"audio","Bitrate":128,"SQPrice":0,"ExtName":"mp3","trans_param":{"cid":-1,"qualitymap":{"attr0":4},"cpy_attr0":0,"classmap":{"attr0":234881032},"pay_block_tpl":1,"musicpack_advance":0,"display":0,"display_rate":0},"Category":0,"SuperExtName":"","HQPkgPrice":0,"OtherName":"","SongName":"<en>阿刁<\/en>","ASQPrivilege":0,"AudioCdn":100,"SourceID":0,"SQDuration":0,"AlbumPrivilege":0,"HQFileSize":0,"AlbumID":"","AlbumName":"","SQPayType":0,"mvdata":[],"vvid":"","HQPrice":0,"Suffix":"","HQFailProcess":0,"MixSongID":"106802666","HasAlbum":0,"SuperBitrate":0,"HiFiQuality":0,"Singers":[{"name":"夏侯钰涵","ip_id":0,"id":554463}],"SingerId":[554463],"ResDuration":0,"HQExtName":"","ResBitrate":0,"MatchFlag":11,"Scid":37478949,"SuperFileHash":"","QualityLevel":1,"OriSongName":"<en>阿刁<\/en>","ResFileHash":"","SongLabel":"","SuperFileSize":0,"MvType":0,"mvTotal":0,"SQBitrate":0,"MvHash":"","FailProcess":0,"SQExtName":"","HQFileHash":"","TopicUrl":"","Auxiliary":"","Privilege":0,"Duration":250,"SQFailProcess":0,"OwnerCount":4,"Uploader":"","ID":"106802666","TopID":0,"FileName":"夏侯钰涵 - <en>阿刁<\/en>","PkgPrice":0,"A320Privilege":0,"RankId":0,"ResFileSize":0,"SQPrivilege":0,"recommend_type":0,"Price":0,"Publish":1}],"Category":1,"SuperExtName":"","HQPkgPrice":0,"OtherName":"","SongName":"<en>阿刁<\/en>","ASQPrivilege":0,"AudioCdn":100,"SourceID":0,"SQDuration":268,"AlbumPrivilege":0,"HQFileSize":10744729,"AlbumID":"19060035","AlbumName":"遇 涵","SQPayType":0,"mvdata":[],"vvid":"","HQPrice":0,"Suffix":"","HQFailProcess":0,"MixSongID":"145380698","HasAlbum":1,"SuperBitrate":0,"HiFiQuality":2,"Singers":[{"name":"夏侯钰涵","ip_id":0,"id":554463}],"SingerId":[554463],"ResDuration":0,"HQExtName":"mp3","ResBitrate":0,"MatchFlag":11,"Scid":40678475,"SuperFileHash":"","QualityLevel":3,"OriSongName":"<en>阿刁<\/en>","ResFileHash":"","SongLabel":"","SuperFileSize":0,"MvType":0,"mvTotal":0,"SQBitrate":765,"MvHash":"","FailProcess":0,"SQExtName":"flac","HQFileHash":"14BCC79228D40901E34C872763968820","TopicUrl":"","Auxiliary":"","Privilege":0,"Duration":268,"SQFailProcess":0,"OwnerCount":1836,"Uploader":"","ID":"145380698","TopID":0,"FileName":"夏侯钰涵 - <en>阿刁<\/en>","PkgPrice":0,"A320Privilege":0,"RankId":0,"ResFileSize":0,"SQPrivilege":0,"recommend_type":0,"Price":0,"Publish":1}],"sec_aggre":{},"aggregation":{},"size":5,"searchfull":1,"chinesecount":2,"istagresult":0,"allowerr":0,"sec_aggre_v2":[],"correctionforce":0,"istag":0,"from":0,"sectag_info":{"is_sectag":0},"subjecttype":0,"isshareresult":0,"correctionsubject":""},"status":1,"error_code":0}
                """;

            var result = JsonSerializer.Deserialize<KugouSearchResult>(text);
            Assert.NotNull(result);
            Assert.Equal(1, result.status);
            Assert.Equal(0, result.error_code);
            Assert.NotNull(result.data);
            Assert.Equal("58A3D5C4D35A63C400E8A1CF4246F30F", result.data.lists[0].SQFileHash);
        }

        [Fact]
        public void ParseSongInfo()
        {
            var text = """
                {"status":1,"err_code":0,"data":{"hash":"3233818D07CAF22FE73B17B15BFCCF80","timelength":321410,"filesize":5143191,"audio_name":"\u5f20\u97f6\u6db5 - \u963f\u5201 (Live)","have_album":1,"album_name":"\u6b4c\u624b\u7b2c\u4e8c\u5b63 \u7b2c\u4e8c\u671f","album_id":"8311612","img":"http:\/\/imge.kugou.com\/stdmusic\/20200812\/20200812171231851695.jpg","have_mv":1,"video_id":"3595502","author_name":"\u5f20\u97f6\u6db5","song_name":"\u963f\u5201 (Live)","lyrics":"\ufeff[id:$00000000]\r\n[ar:\u5f20\u97f6\u6db5]\r\n[ti:\u963f\u5201 (Live)]\r\n[by:]\r\n[hash:47dda3eb23d35686cd87ca977d5875fd]\r\n[al:]\r\n[sign:]\r\n[qq:]\r\n[total:321041]\r\n[offset:0]\r\n[00:00.00]\u5f20\u97f6\u6db5 - \u963f\u5201 (Live)\r\n[00:00.57]\u4f5c\u8bcd\uff1a\u8d75\u96f7\r\n[00:00.72]\u4f5c\u66f2\uff1a\u8d75\u96f7\r\n[00:00.87]Rap\u586b\u8bcd\uff1a\u4e25\u827a\u4e39\r\n[00:01.08]\u539f\u5531\uff1a\u8d75\u96f7\r\n[00:01.23]\u7f16\u66f2\uff1a\u5b54\u5fb7\u5cb3\u3001\u9f99\u9686\r\n[00:01.48]\u5236\u4f5c\u4eba\uff1a\u9f99\u9686\u3001\u5b8b\u4e88\u5bbe\r\n[00:01.79]Program\uff1a\u5b54\u5fb7\u5cb3\r\n[00:01.94]\u4f34\u5531\uff1a\u897f\u66fc\r\n[00:02.09]\u7ae5\u58f0\uff1a\u6e56\u5357\u7701\u9752\u5c11\u5e74\u6d3b\u52a8\u4e2d\u5fc3\u5c11\u513f\u827a\u672f\u56e2\r\n[00:33.66]\u963f\u5201\u4f4f\u5728\u897f\u85cf\u7684\u67d0\u4e2a\u5730\u65b9\r\n[00:42.64]\u79c3\u9e6b\u4e00\u6837\u6816\u606f\u5728\u5c71\u9876\u4e0a\r\n[00:52.82]\u963f\u5201\u5927\u662d\u5bfa\u95e8\u524d\u94fa\u6ee1\u9633\u5149\r\n[01:01.62]\u6253\u4e00\u58f6\u751c\u8336\r\n[01:05.33]\u6211\u4eec\u804a\u7740\u8fc7\u5f80\r\n[01:31.28]\u963f\u5201\u4f60\u603b\u628a\u81ea\u5df1\u6253\u626e\u5f97\u50cf\r\n[01:40.02]\u7537\u5b69\u5b50\u4e00\u6837\r\n[01:43.84]\u53ef\u6bd4\u683c\u6851\u8fd8\u987d\u5f3a\r\n[01:50.40]\u963f\u5201\u865a\u4f2a\u7684\u4eba\u6709\u5343\u767e\u79cd\u7b11\r\n[01:59.19]\u4f60\u4f55\u65f6\u4e0b\u5c71\r\n[02:03.05]\u8bb0\u5f97\u5e26\u4e0a\u5353\u739b\u5200\r\n[02:08.81]\u7070\u8272\u5e3d\u6a90\u4e0b\u51f9\u9677\u7684\u8138\u988a\r\n[02:13.59]\u4f60\u5f88\u5c11\u8bf4\u8bdd\u7b80\u5355\u7684\u56de\u7b54\r\n[02:18.36]\u660e\u5929\u5728\u54ea\u91cc\u8c01\u4f1a\u5728\u610f\u4f60\r\n[02:23.13]\u5373\u4f7f\u5012\u5728\u8def\u4e0a\r\n[02:29.44]\u63a5\u53d7\u653e\u9010\u56f0\u60d1\u81ea\u7531\r\n[02:32.96]\u5c31\u50cf\u98ce\u4e00\u6837\u5439\u8fc7\u574e\u5777\r\n[02:37.00]\u4e0d\u5e73\u7684\u8def\u9014\r\n[02:38.73]\u6f2b\u6f2b\u7684\u811a\u6b65\u5a46\u5a11\r\n[02:41.01]\u6162\u6162\u7684\u8db3\u8ff9\u6591\u9a73\r\n[02:43.50]\u6216\u8005 \u8fde\u4e00\u4e1d\u75d5\u8ff9\r\n[02:45.69]\u90fd\u4e0d\u7559\u5728\u8fd9\u91cc\r\n[02:48.35]\u53ef\u6211 \u8fd8\u662f\u4e0d\u4f1a\r\n[02:50.74]\u56e0\u4e3a\u75db\u5c31\u653e\u5f03\u5e0c\u671b\r\n[02:53.07]\u53d7\u8fc7\u7684\u4f24\u957f\u6210\u75a4\r\n[02:55.31]\u5f00\u51fa\u65e0\u6bd4\u7f8e\u4e3d\u7684\u82b1\r\n[02:57.76]\u53d7\u8fc7\u7684\u4f24\u957f\u6210\u75a4\r\n[02:59.90]\u5f00\u51fa\u65e0\u6bd4\u7f8e\u4e3d\u7684\u82b1\r\n[03:07.20]\u963f\u5201\u660e\u5929\u662f\u5426\u80fd\u5403\u987f\u9971\u996d\r\n[03:16.20]\u4f60\u5df2\u4e60\u60ef\u5b64\u72ec\u662f\u4e00\u79cd\u4fe1\u4ef0\r\n[03:26.33]\u963f\u5201\u4e0d\u4f1a\u88ab\u73b0\u5b9e\u78e8\u5e73\u68f1\u89d2\r\n[03:35.15]\u4f60\u4e0d\u662f\u8fd9\u4e16\u754c\u7684\u4eba\u5450\r\n[03:38.81]\u6ca1\u5fc5\u8981\u5728\u4e4e\u771f\u76f8\r\n[03:44.87]\u547d\u8fd0\u591a\u821b \u75f4\u8ff7 \u6de1\u7136\r\n[03:49.56]\u6325\u522b\u4e86\u9752\u6625\u6570\u4e0d\u5c3d\u7684\u8f66\u7ad9\r\n[03:54.34]\u7518\u4e8e\u5e73\u51e1\u5374\u4e0d\u7518\u5e73\u51e1\u5730\u6e83\u8d25\r\n[03:59.13]\u4f60\u662f\u963f\u5201\u4f60\u662f\u81ea\u7531\u7684\u9e1f\r\n[04:23.33]\u547d\u8fd0\u591a\u821b \u75f4\u8ff7 \u6de1\u7136\r\n[04:27.91]\u6325\u522b\u4e86\u9752\u6625\u6570\u4e0d\u5c3d\u7684\u8f66\u7ad9\r\n[04:32.63]\u7518\u4e8e\u5e73\u51e1\u5374\u4e0d\u7518\u5e73\u51e1\u5730\u6e83\u8d25\r\n[04:37.46]\u4f60\u662f\u963f\u5201\r\n[04:52.88]\u963f\u5201\u7231\u60c5\u662f\u7c92\u60b2\u4f24\u7684\u79cd\u5b50\r\n[05:01.71]\u4f60\u662f\u4e00\u68f5\u6811\r\n[05:05.32]\u4f60\u6c38\u8fdc\u90fd\u4e0d\u4f1a\u67af\r\n","author_id":"6811","privilege":10,"privilege2":"1010","play_url":"https:\/\/webfs.ali.kugou.com\/202306072147\/55e98b97c07a64d05ad01a6a9c8fcca4\/part\/0\/960127\/KGTX\/CLTX001\/clip_3233818d07caf22fe73b17b15bfccf80.mp3","authors":[{"author_id":"6811","author_name":"\u5f20\u97f6\u6db5","is_publish":"1","sizable_avatar":"http:\/\/singerimg.kugou.com\/uploadpic\/softhead\/{size}\/20230511\/20230511191418434.jpg","e_author_id":"6KRKBBB651DB","avatar":"http:\/\/singerimg.kugou.com\/uploadpic\/softhead\/400\/20230511\/20230511191418434.jpg"}],"is_free_part":1,"bitrate":128,"recommend_album_id":"8311612","store_type":"audio","album_audio_id":105920545,"is_publish":1,"e_author_id":"6KRKBBB651DB","audio_id":"36722401","has_privilege":true,"play_backup_url":"https:\/\/webfs.hw.kugou.com\/202306072147\/871e1eef96c1ff1551b837b369c0bfb6\/part\/0\/960127\/KGTX\/CLTX001\/clip_3233818d07caf22fe73b17b15bfccf80.mp3","trans_param":{"hash_offset":{"start_byte":0,"end_byte":960127,"start_ms":0,"end_ms":60000,"offset_hash":"18CF4D1179E8D0069BAA9684362FBD5E","file_type":0,"clip_hash":"D85B94900FA786689ADB032D65AB9EB1"},"musicpack_advance":1,"pay_block_tpl":1,"display":32,"display_rate":1,"appid_block":"3124","cpy_grade":5,"cpy_level":1,"cid":32027466,"cpy_attr0":15488,"classmap":{"attr0":234885128},"hash_multitrack":"D2ACC4DBB1320BE836D4B27B6B6A956E","qualitymap":{"attr0":49268}},"small_library_song":1,"encode_album_id":"4y5a47d","encode_album_audio_id":"1r28tdd2","e_video_id":"252b2d1"}}
                """;

            var result = JsonSerializer.Deserialize<KugouSongResult>(text);
            Assert.NotNull(result);
            Assert.Equal(1, result.status);
            Assert.Equal(0, result.err_code);
            Assert.Equal("3233818D07CAF22FE73B17B15BFCCF80", result.data.hash);
            Assert.Equal("阿刁 (Live)", result.data.song_name);
            Assert.Equal("6811", result.data.authors.First().author_id);
        }


        [Fact]
        public async Task DownloadAsync()
        {
            var song = await _kugou.GetSongAsync(GetSongParam);
            var url = song.Urls.First();
            var data = await _kugou.DownloadAsync(url.Url);
            var file = song.Name + "." + url.Ext;
            File.WriteAllBytes(file, data);
            if (File.Exists(file))
            {
                Assert.True(true);
                File.Delete(file);
            }
            else Assert.True(false);
        }
    }
}
